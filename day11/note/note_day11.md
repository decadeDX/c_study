# 嵌入式学习 c语言基础 day11



# 结构体

## 概念

- 结构体就是将基本的数据类型进行封装，到一个统一的自定义类型中的语法。

- 比如：学生信息有姓名、年龄、分数等等，由于数据类型不同，无法用一个数组来保存，结构体就可以完成学生信息的定义和存储。

## 结构体定义方式

- struct 结构体名 {数据类型1 成员名1; 数据类型2 成员名2;.....};

- 结构体变量的定义

  - struct 结构体名 结构变量名;

  - 如果需要用结构变量名获取其中的成员值，就需要用.运算符来完成

## 结构体数组

### 定义方式

- 结构体类型名 结构体数组名[数组长度];

- 结构体指针
  - 定义方式
    - 结构体类型名* 结构体指针名

### 时间函数

- 包含在头文件time.h

- 获取时间戳

  - time_t time(time_t ptm);

  - 可以获取从1970年1月1日到当前时间秒数

### 将时间戳直接转化为字符串

- char* ctime(time_t *ptm);

- 可以根据时间戳返回一个固定格式的日期字符串

### 结构体内存对齐问题

- 结构体对齐原则

  - 1、结构体的第一个成员在结构体的开始的地址处

  - 2、其他成员要对齐到某个数字的整数倍的地址处，（这个数字叫做对齐数）
    - 对齐数：编译器默认的对齐数和该成员的较小值（vs中默认的对齐数是8，Linux中默认的对齐数是4）

  - 3、结构体占用总大小是结构体中最大对齐数的整数倍

  - 4、如果结构体出现了嵌套，嵌套的结构体首地址应该按照其成员中最大对齐数的整数倍地址处存放

- 例1：
  - 代码![img](https://api2.mubu.com/v3/document_image/4733041_a3438ce6-2319-41ab-80ff-2dc7cbf9d7fd.png?)![img](https://api2.mubu.com/v3/document_image/4733041_5dc547ac-805f-42ea-e105-b067c0bb8dae.png?)

- 例2：
  - 代码![img](https://api2.mubu.com/v3/document_image/4733041_7f390aa6-e6d1-418a-b335-3b9771a34f83.png?)![img](https://api2.mubu.com/v3/document_image/68e57753-89f6-476f-9cf7-4aea21f7be69-4733041.jpg?)

- 例3
  - 代码![img](https://api2.mubu.com/v3/document_image/4733041_ea985e00-1612-4b77-8b95-b39dbaed3246.png?)![img](https://api2.mubu.com/v3/document_image/4733041_208b1594-b2ef-4c3a-939c-1c063e2b745e.png?)

- 例4:
  - 代码![img](https://api2.mubu.com/v3/document_image/68cd761b-0621-4fae-87dc-c573d82d0e2d-4733041.jpg?)![img](https://api2.mubu.com/v3/document_image/4733041_63ee8856-9917-44cf-aece-1d55d38f21bb.png?)

- 例5：
  - 代码![img](https://api2.mubu.com/v3/document_image/4733041_da9ce315-ca13-484f-c144-45d0bf1cfc46.png?)![img](https://api2.mubu.com/v3/document_image/4733041_bbb1a3f0-5442-4cd9-ca2b-3401bca86a86.png?)

## 位段（位域）

- C语言允许多个结构体成员来使用几位存储数据![img](https://api2.mubu.com/v3/document_image/4733041_b9c9ce6f-6713-4067-8e1c-3da4f70bf1b2.png?)

# 枚举类型

- 概念：用标识符表示整型常量的集合，用关键字enum来定义

- 枚举类型语法：enum 枚举类型名 {枚举元素1, 枚举元素2...};

- 注意点：

  - 枚举元素如果没有给初始值，默认第一个枚举元素代表0，后面的枚举元素依次加1,

  - 枚举元素不能重名

# 内存空间区块划分

## 栈区

- 由系统自动分配和释放空间，随着函数的开始而开始，随着函数的结束而结束。

- 堆区
  - 由用户手动分配释放的空间，随着用户的创建而存在，随着用户的释放而结束。

## 静态区

- 主要存放的是全局资源，它们不会被释放，随着程序的开始而开始，随着程序的结束而结束。

- 常量区
  - 各种常量资源，除了字符串常量以外，所有的常量都保存在这里。因为字符串常量会存放在专属的字符串常量区

## 代码区

- 代码存放的区域，执行的时候直接从这里取出。

# 变量的生命周期

## 局部变量

- 在函数内部定义的变量，就是局部变量

## 全局变量

- 在函数外部定义的变量，就是全局变量

## 静态变量

- 静态变量：静态存储的变量在程序运行期间，会分配固定的存储空间并且一直存在。

- 动态变量：函数中声明的普通变量，在函数被调用的时候会分配空间存在，离开时被释放，当再一次调用函数的时候，重新为其分配空间。

- 静态变量定义：static 数据类型 变量名;